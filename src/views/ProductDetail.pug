doctype html
html
    head
        title #{product.title} | Store
        style.
            body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; color: #333; }
            .product-container { max-width: 1000px; margin: 0 auto; }

            /* Main Product Section */
            .product-main { display: flex; gap: 40px; margin-bottom: 50px; align-items: flex-start; }
            .main-img { width: 450px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
            .product-info { flex: 1; }
            .brand-badge { color: #666; letter-spacing: 1px; font-size: 0.9rem; }

            /* Favorite Button */
            #fav-btn { 
                padding: 12px 24px; font-size: 1rem; cursor: pointer; border-radius: 8px;
                border: 2px solid #ff4757; background: white; color: #ff4757;
                transition: all 0.2s ease; display: flex; align-items: center; gap: 8px;
            }
            #fav-btn.active { background: #ff4757; color: white; }

            /* Gallery Section */
            .gallery-section { border-top: 1px solid #eee; padding-top: 30px; }
            .gallery-row { 
                display: flex; gap: 20px; overflow-x: auto; padding: 10px 0;
                scrollbar-width: thin;
            }
            .gallery-item { 
                flex: 0 0 180px; text-decoration: none; color: inherit; 
                transition: transform 0.2s; 
            }
            .gallery-item:hover { transform: translateY(-5px); }
            .gallery-item img { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; }
            .gallery-item p { margin: 10px 0; font-weight: 500; font-size: 0.9rem; }
            .back-link {
                display: inline-block;
                margin: 20px 0 10px 20px;
                text-decoration: none;
                color: #666;
                font-size: 1.5rem;
                transition: color 0.2s;
            }

            .back-link:hover {
                color: #000;
                text-decoration: underline;
            }

    body
        .product-container
            a.back-link(href="/products") ‚Üê Back to Home
            //- a. Main Product Section
            section.product-main
                img.main-img(src=product.image_url, alt=product.title)

                div.product-info
                    h1= product.title
                    p.brand-badge= `Brand: ${product.brand.name}`
                    p.brand-badge= `Type: ${product.type.name}`

                    //- c. Favorite Button
                    button#fav-btn(class=isFavorited ? 'active' : '' onclick=`toggleFavorite('${product._id}')`)
                        span= isFavorited ? '‚ù§Ô∏è' : 'ü§ç'
                        span= isFavorited ? 'Saved to Favorites' : 'Add to Favorites'

            p.description= `Description: ${product.description}`
            //- b. Brand Gallery
            section.gallery-section
                h2 More from #{product.brand.name}
                .gallery-row
                    each item in brandProducts
                        if item._id.toString() !== product._id.toString()
                            a.gallery-item(href=`/products/details/${item._id}`)
                                img(src=item.image_url, alt=item.title)
                                p= item.title

        script.
            let favorited = #{isFavorited}
            async function toggleFavorite(productId) {
                
                const btn = document.getElementById('fav-btn');
                const icon = btn.querySelector('span:first-child');
                const text = btn.querySelector('span:last-child');

                try {
                const response = await fetch(`/api/favorites/${productId}`, { method: favorited ? 'DELETE' : 'POST' });
                const data = await response.json();

                if (data.success) {
                    // Toggle classes and text locally without page reload
                    btn.classList.toggle('active');
                    favorited = !favorited;
                    icon.innerText = favorited ? '‚ù§Ô∏è' : 'ü§ç';
                    text.innerText = favorited ? 'Saved to Favorites' : 'Add to Favorites';

                }
                } catch (err) {
                alert("Something went wrong updating your favorites.");
                }
            }